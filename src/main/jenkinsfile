node('jdk8') {
   // define commands
   def mvnHome = tool 'M3'
   def mvnCmd = "${mvnHome}/bin/mvn -s ${env.JENKINS_HOME}/settings.xml"
   def ocCmd = "/usr/bin/oc --token=`cat /var/run/secrets/kubernetes.io/serviceaccount/token` --server=https://openshift.default.svc.cluster.local --certificate-authority=/run/secrets/kubernetes.io/serviceaccount/ca.crt
   

   stage 'Deploy STAGE'
   // clean up. keep the imagestream
   sh "${ocCmd} delete bc,dc,svc,route -l app=tasks -n stage"
   // deploy stage image
   sh "${ocCmd} new-app tasks:${v} -n stage"
   sh "${ocCmd} expose svc/tasks -n stage"
}

def version() {
  def matcher = readFile('pom.xml') =~ '<version>(.+)</version>'
  matcher ? matcher[0][1] : null
}
